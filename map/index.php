<?php require_once(__DIR__. '/../vendor/autoload.php'); ?>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Nook of Europe</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <link rel="stylesheet" type="text/css" href="css/nookmap.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script src="js/geojson.js"></script>
    <script src="js/markers.js.php?<?php echo $_SERVER['QUERY_STRING']; ?>"></script>
    <script src="js/markers.zone.js.php?<?php echo $_SERVER['QUERY_STRING']; ?>"></script>
    <script>

var baranyahun = {"type":"Polygon","coordinates":[[[17.64678955078125,45.84793427349226],[17.666015625,45.85654288638554],[17.678375244140625,45.869931413475676],[17.700347900390625,45.865150166790585],[17.727813720703125,45.865150166790585],[17.733306884765625,45.88522863923791],[17.72369384765625,45.91294412737392],[17.681121826171875,45.92631906688103],[17.686614990234375,45.94255573048781],[17.656402587890625,45.95305927379983],[17.6495361328125,45.9349155397806],[17.631683349609375,45.93969078234],[17.628936767578125,45.988374767708116],[17.655029296875,45.99314540468519],[17.655029296875,46.011270075088085],[17.626190185546875,46.04368887663177],[17.66876220703125,46.06179698466216],[17.67974853515625,46.08942422913245],[17.667388916015625,46.10370875598025],[17.683868408203125,46.112277695957935],[17.678375244140625,46.12941157969048],[17.703094482421875,46.195042108660154],[17.72369384765625,46.20264638061019],[17.714080810546875,46.220702308799446],[17.73468017578125,46.234002878622526],[17.749786376953125,46.205497711275896],[17.77313232421875,46.201695904168325],[17.78961181640625,46.22830302903788],[17.80609130859375,46.22450280046105],[17.815704345703125,46.21215024064955],[17.841796875,46.207398516170045],[17.876129150390625,46.22450280046105],[17.917327880859375,46.226402947634966],[17.93243408203125,46.24635052207288],[17.933807373046875,46.270088180220725],[17.939300537109375,46.29855980566551],[17.996978759765625,46.30994431269354],[18.017578125,46.29666215765572],[18.035430908203125,46.29761098988109],[18.0670166015625,46.292866664344295],[18.101348876953125,46.30140615437332],[18.11920166015625,46.281478606060816],[18.13018798828125,46.29476444388206],[18.109588623046875,46.31468715855948],[18.16864013671875,46.32417161725691],[18.197479248046875,46.33365443192931],[18.204345703125,46.35640647967248],[18.186492919921875,46.36967413462374],[18.183746337890625,46.39904104733023],[18.22357177734375,46.4056700993737],[18.25103759765625,46.403776166694634],[18.293609619140625,46.40756396630067],[18.314208984375,46.417979059090115],[18.345794677734375,46.39619977845332],[18.343048095703125,46.37535928611454],[18.37188720703125,46.354510837365254],[18.389739990234375,46.34123949998618],[18.37188720703125,46.313738622267394],[18.376007080078125,46.29191774991382],[18.414459228515625,46.2890709079757],[18.408966064453125,46.26154380710643],[18.39385986328125,46.23780244949404],[18.35540771484375,46.220702308799446],[18.378753662109375,46.2102496001872],[18.439178466796875,46.24635052207288],[18.46527099609375,46.26534147068603],[18.48175048828125,46.27388525189855],[18.474884033203125,46.30330363797423],[18.511962890625,46.29191774991382],[18.52294921875,46.26913887119721],[18.543548583984375,46.27388525189855],[18.527069091796875,46.234002878622526],[18.5504150390625,46.219752144776876],[18.56964111328125,46.22545288226939],[18.57513427734375,46.21785176740299],[18.565521240234375,46.20454728416395],[18.592987060546875,46.17983040759436],[18.614959716796875,46.1912395780416],[18.689117431640625,46.126556302418514],[18.755035400390625,46.11132565729796],[18.78936767578125,46.11132565729796],[18.76190185546875,46.08275685027116],[18.741302490234375,46.057985244793024],[18.727569580078125,46.03987588680908],[18.755035400390625,46.026528350100904],[18.793487548828125,46.02462129598765],[18.823699951171875,46.03129569755731],[18.840179443359375,46.04368887663177],[18.86627197265625,46.0208069903933],[18.83331298828125,45.98169518512228],[18.8360595703125,45.96833360206372],[18.8250732421875,45.95878764035639],[18.840179443359375,45.94351068030586],[18.801727294921875,45.93205019685629],[18.818206787109375,45.916765867649005],[18.807220458984375,45.90147732739488],[18.80859375,45.87758055276022],[18.766021728515625,45.88714049635727],[18.74542236328125,45.89956596377031],[18.72344970703125,45.90338862522072],[18.705596923828125,45.921542672881436],[18.669891357421875,45.91198865118152],[18.656158447265625,45.919632000136545],[18.65753173828125,45.89956596377031],[18.6383056640625,45.88618457602257],[18.65478515625,45.8766244679252],[18.634185791015625,45.86610644902818],[18.625946044921875,45.879492673079945],[18.623199462890625,45.85176048817253],[18.609466552734375,45.8536734968093],[18.62457275390625,45.838367585245855],[18.599853515625,45.83358362421937],[18.598480224609375,45.817315080406246],[18.56689453125,45.81061488635732],[18.573760986328125,45.7943396304607],[18.551788330078125,45.800084381319905],[18.52294921875,45.781890638500826],[18.49822998046875,45.7943396304607],[18.483123779296875,45.78763667258138],[18.48175048828125,45.76273291410593],[18.45428466796875,45.769438866203906],[18.44879150390625,45.73781803408217],[18.40484619140625,45.7387765043515],[18.389739990234375,45.75219336063106],[18.389739990234375,45.76273291410593],[18.3636474609375,45.77327047688937],[18.348541259765625,45.75794245476208],[18.337554931640625,45.744526980468436],[18.3251953125,45.75698431353718],[18.293609619140625,45.761774855141226],[18.2757568359375,45.75698431353718],[18.2427978515625,45.75985868785574],[18.227691650390625,45.779975162193914],[18.1988525390625,45.78093290857323],[18.183746337890625,45.78859428734741],[18.16864013671875,45.77327047688937],[18.1439208984375,45.79050946752472],[18.116455078125,45.789551885661844],[18.09722900390625,45.765606992288184],[18.057403564453125,45.769438866203906],[18.018951416015625,45.78093290857323],[17.994232177734375,45.79625461321959],[17.972259521484375,45.78859428734741],[17.94891357421875,45.79242458189575],[17.920074462890625,45.786679041363726],[17.900848388671875,45.79242458189575],[17.870635986328125,45.77518618352103],[17.859649658203125,45.7646489826794],[17.851409912109375,45.78093290857323],[17.82806396484375,45.79338211440398],[17.8253173828125,45.81061488635732],[17.80609130859375,45.805828539928356],[17.77862548828125,45.81827218518002],[17.7593994140625,45.81157210628933],[17.741546630859375,45.827842328108964],[17.705841064453125,45.83166992465285],[17.6824951171875,45.84028105450088],[17.664642333984375,45.83454044932633],[17.653656005859375,45.84219445795287],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226],[17.64678955078125,45.84793427349226]]]};

var baranyacro = {"type":"Polygon","coordinates":[[[18.820953369140625,45.916765867649005],[18.82781982421875,45.907211023476776],[18.8690185546875,45.91198865118152],[18.863525390625,45.92249798457993],[18.878631591796875,45.915810457254395],[18.89373779296875,45.921542672881436],[18.90472412109375,45.91294412737392],[18.873138427734375,45.89956596377031],[18.873138427734375,45.88618457602257],[18.903350830078125,45.874712248904764],[18.89373779296875,45.85845573051733],[18.853912353515625,45.86132487333674],[18.856658935546875,45.849847413733556],[18.856658935546875,45.829756159282766],[18.834686279296875,45.816357959181346],[18.859405517578125,45.805828539928356],[18.878631591796875,45.81061488635732],[18.896484375,45.827842328108964],[18.91571044921875,45.82114340079471],[18.925323486328125,45.80199916666152],[18.919830322265625,45.78572139369445],[18.91845703125,45.77614401215916],[18.896484375,45.77327047688937],[18.875885009765625,45.78572139369445],[18.851165771484375,45.77327047688937],[18.86627197265625,45.76081677972451],[18.897857666015625,45.74931859146165],[18.919830322265625,45.74644367422241],[18.944549560546875,45.75794245476208],[18.963775634765625,45.769438866203906],[18.973388671875,45.75506798173109],[18.977508544921875,45.7387765043515],[18.96240234375,45.72631510756138],[18.9239501953125,45.72248027224107],[18.908843994140625,45.72248027224107],[18.908843994140625,45.711933117768446],[18.94317626953125,45.71672752568247],[18.973388671875,45.72152152227954],[18.977508544921875,45.70522025567307],[18.97064208984375,45.69371061645447],[18.94317626953125,45.701383972513526],[18.922576904296875,45.706179285330855],[18.919830322265625,45.69850658738845],[18.94866943359375,45.6841174406096],[18.97064208984375,45.663966415824056],[18.97613525390625,45.65340822133457],[18.93218994140625,45.64284803596584],[18.933563232421875,45.63132556313632],[18.94866943359375,45.63516665067312],[18.952789306640625,45.62652383350405],[18.93218994140625,45.62460302647396],[18.917083740234375,45.62652383350405],[18.91021728515625,45.613076802161146],[18.944549560546875,45.61787968356969],[18.947296142578125,45.60346980528809],[18.930816650390625,45.598665689820656],[18.907470703125,45.596743928454124],[18.8909912109375,45.578483912834606],[18.911590576171875,45.566948210863636],[18.9349365234375,45.55925642651572],[18.929443359375,45.54483149242463],[18.944549560546875,45.534250854382684],[18.99261474609375,45.534250854382684],[19.00909423828125,45.558294879426235],[19.0283203125,45.553486897157995],[19.035186767578125,45.53521281284293],[19.081878662109375,45.52847875806646],[19.103851318359375,45.51308360513235],[19.092864990234375,45.491908391571016],[19.05853271484375,45.48420633926945],[19.02008056640625,45.4890202453737],[19.002227783203125,45.4986468234261],[18.984375,45.452424241343095],[18.996734619140625,45.43508099838452],[18.97064208984375,45.43604465175716],[18.9459228515625,45.430262484682125],[18.94317626953125,45.44278976460039],[18.92120361328125,45.454350939222046],[18.925323486328125,45.463983441272724],[18.906097412109375,45.47361429775641],[18.8800048828125,45.48709473229837],[18.84979248046875,45.48228066163947],[18.840179443359375,45.46687287100197],[18.812713623046875,45.45627757127798],[18.796234130859375,45.464946600971466],[18.7921142578125,45.45627757127798],[18.8140869140625,45.44278976460039],[18.793487548828125,45.440862671781765],[18.796234130859375,45.42833496400943],[18.807220458984375,45.41002023463975],[18.779754638671875,45.4071278922143],[18.7591552734375,45.41484047622611],[18.73443603515625,45.413876460821086],[18.7042236328125,45.404235401683344],[18.68499755859375,45.39555704145536],[18.65203857421875,45.39266395850033],[18.6492919921875,45.37626702418104],[18.64105224609375,45.36661954708626],[18.653411865234375,45.35311031446323],[18.623199462890625,45.34635448859443],[18.636932373046875,45.32704768567264],[18.631439208984375,45.314494733802604],[18.582000732421875,45.31739181570156],[18.582000732421875,45.30580259943578],[18.5614013671875,45.2951770693957],[18.538055419921875,45.30387083299528],[18.510589599609375,45.29034662473615],[18.516082763671875,45.24782097102814],[18.50372314453125,45.24105258851866],[18.527069091796875,45.233316306787266],[18.521575927734375,45.206231026242214],[18.488616943359375,45.2110686297804],[18.46527099609375,45.20719857986463],[18.45428466796875,45.215905821884036],[18.414459228515625,45.217840583523945],[18.384246826171875,45.232349197513095],[18.395233154296875,45.24492033441031],[18.35540771484375,45.24878781698633],[18.307342529296875,45.24395342262324],[18.282623291015625,45.23911861682938],[18.271636962890625,45.226546196265026],[18.2208251953125,45.215905821884036],[18.189239501953125,45.22461173085719],[18.186492919921875,45.238151606298835],[18.148040771484375,45.24395342262324],[18.137054443359375,45.2574886900362],[18.12469482421875,45.25458854713424],[18.09173583984375,45.25555527789205],[18.071136474609375,45.26618823005583],[18.09173583984375,45.29324494090279],[18.11370849609375,45.302904925089685],[18.101348876953125,45.314494733802604],[18.095855712890625,45.335736561593784],[18.06427001953125,45.34249365462379],[18.095855712890625,45.36276009546727],[18.112335205078125,45.36854917415683],[18.106842041015625,45.38301927899065],[18.087615966796875,45.404235401683344],[18.057403564453125,45.39652136952787],[18.035430908203125,45.39362833594161],[18.010711669921875,45.41869637328527],[17.983245849609375,45.413876460821086],[17.966766357421875,45.433153642271414],[17.93792724609375,45.45049747764105],[17.898101806640625,45.453387598510474],[17.884368896484375,45.46590974421453],[17.895355224609375,45.48420633926945],[17.920074462890625,45.493833740092185],[17.940673828125,45.50153447596235],[17.958526611328125,45.53521281284293],[17.980499267578125,45.54964021515787],[17.994232177734375,45.57367765830111],[18.013458251953125,45.592900208269846],[18.03131103515625,45.612116176517304],[18.03680419921875,45.63900747494936],[18.017578125,45.66300666222867],[18.0010986328125,45.68315803253308],[18.002471923828125,45.7205627558654],[17.9681396484375,45.72439772280636],[17.95166015625,45.73110828152976],[17.925567626953125,45.72727377526009],[17.928314208984375,45.75506798173109],[17.914581298828125,45.763690956618674],[17.91046142578125,45.79529713006589],[17.920074462890625,45.786679041363726],[17.94891357421875,45.79242458189575],[17.972259521484375,45.78859428734741],[17.994232177734375,45.79625461321959],[18.018951416015625,45.78093290857323],[18.057403564453125,45.769438866203906],[18.09722900390625,45.765606992288184],[18.116455078125,45.789551885661844],[18.1439208984375,45.79050946752472],[18.16864013671875,45.77327047688937],[18.183746337890625,45.78859428734741],[18.1988525390625,45.78093290857323],[18.227691650390625,45.779975162193914],[18.2427978515625,45.75985868785574],[18.2757568359375,45.75698431353718],[18.293609619140625,45.761774855141226],[18.3251953125,45.75698431353718],[18.337554931640625,45.744526980468436],[18.348541259765625,45.75794245476208],[18.3636474609375,45.77327047688937],[18.389739990234375,45.76273291410593],[18.389739990234375,45.75219336063106],[18.40484619140625,45.7387765043515],[18.44879150390625,45.73781803408217],[18.45428466796875,45.769438866203906],[18.48175048828125,45.76273291410593],[18.483123779296875,45.78763667258138],[18.49822998046875,45.7943396304607],[18.52294921875,45.781890638500826],[18.551788330078125,45.800084381319905],[18.573760986328125,45.7943396304607],[18.56689453125,45.81061488635732],[18.598480224609375,45.817315080406246],[18.599853515625,45.83358362421937],[18.62457275390625,45.838367585245855],[18.609466552734375,45.8536734968093],[18.623199462890625,45.85176048817253],[18.625946044921875,45.879492673079945],[18.634185791015625,45.86610644902818],[18.65478515625,45.8766244679252],[18.6383056640625,45.88618457602257],[18.65753173828125,45.89956596377031],[18.656158447265625,45.919632000136545],[18.669891357421875,45.91198865118152],[18.705596923828125,45.921542672881436],[18.72344970703125,45.90338862522072],[18.74542236328125,45.89956596377031],[18.766021728515625,45.88714049635727],[18.80859375,45.87758055276022],[18.807220458984375,45.90147732739488],[18.818206787109375,45.916765867649005]]]};

var map,homeLatlng;

var MY_MAPTYPE_ID = 'custom_style';

function initialize() {

  var featureOpts = [
    {
      stylers: [
        { huee: '#890000' },
        { visibility: 'simplified' },
        { gamma: 0.5 },
        { weight: 0.5 }
      ]
    },
    {
      elementType: 'labels',
      stylers: [
        { visibility: 'off' }
      ]
    },
    {
      featureType: 'water',
      stylers: [
        { colorr: '#890000' }
      ]
    }
  ];
  homeLatlng = new google.maps.LatLng(45.760652, 18.273697);
  var mapOptions = {
    zoom: 9,
    center: homeLatlng,
    mapTypeControlOptions: {
      mapTypeIds: [google.maps.MapTypeId.ROADMAP, MY_MAPTYPE_ID]
    },
    mapTypeId: MY_MAPTYPE_ID,
    disableDefaultUI: true
  };
  

  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
  google.maps.event.addDomListener(window, 'resize', function() {
       map.setCenter(homeLatlng);
  });
  parent.$('#mapToggle').click(
      function() {
          parent.$('#mapMain').toggle(500,function(){map.setCenter(homeLatlng);});
      }
  );
                                  

  var styledMapOptions = {
    name: 'Nook of Europe'
  };

  var markerIcon = {
      url: 'img/marker.png',
      size: new google.maps.Size(32, 32),
      origin: new google.maps.Point(0,0),
      anchor: new google.maps.Point(16, 32)
  };
  var markerShape = {
	coord: [6, 1, 26, 1, 26, 20, 6 , 20],
        type: 'poly'
  };

  var customMapType = new google.maps.StyledMapType(featureOpts, styledMapOptions);

  map.mapTypes.set(MY_MAPTYPE_ID, customMapType);
  var baranyaHunPoly = new GeoJSON(baranyahun, {strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.15
  });
  baranyaHunPoly.setMap(map);

  var baranyaCroPoly = new GeoJSON(baranyacro, {strokeColor: '#0000FF',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#0000FF',
      fillOpacity: 0.15
  });
  baranyaCroPoly.setMap(map);

  
  markers.forEach(function (marker) {
      var gMarker = new google.maps.Marker({
        position: new google.maps.LatLng(marker.latt, marker.long),
	map: map,
	icon: markerIcon,
	title: marker.name,
	mydata: marker
      });

      google.maps.event.addListener(gMarker, 'click', function() {
	      if (typeof infowindow != 'undefined') {
		  infowindow.close();
	      }
	      //console.log(gMarker.mydata);
	      infowindow = new google.maps.InfoWindow({
		      content: '<h2>' + gMarker.mydata.name + '</h2><strong>Cim: </strong>' + gMarker.mydata.contact_address 
		});
	      infowindow.open(map,gMarker);
	      
      });
  });

  markers_zone.forEach(function (marker) {
      var gMarker = new google.maps.Marker({
        position: new google.maps.LatLng(marker.latt, marker.long),
        map: map,
        icon: markerIcon,
        title: marker.name,
        mydata: marker
      });

      google.maps.event.addListener(gMarker, 'click', function() {
              if (typeof infowindow != 'undefined') {
                  infowindow.close();
              }
              console.log(gMarker.mydata);
              infowindow = new google.maps.InfoWindow({
                      content: '<h2>' + gMarker.mydata.name + '</h2><strong>Terület: </strong>' + gMarker.mydata.area
                });
              infowindow.open(map,gMarker);

      });
  });
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
<?php
$countryWhiteList = ['hu', 'cr'];
$typeWhiteList = ['stake', 'zone', 'estate', 'nature'];

if(isset($_GET['button1id'])) {
    $type = isset($_GET['type'])?$_GET['type']:[];
    $country = isset($_GET['country'])?$_GET['country']:[];
} else {
    $type = $typeWhiteList;
    $country = $countryWhiteList;
}
$type = array_intersect($type, $typeWhiteList);
$country = array_intersect($country, $countryWhiteList);
?>
    <!--div id="map-canvas"></div-->
    <div id="filter-panel" class=".col-xs-6 .col-sm-4 panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title">Szűrő</h3>
        </div>
    <form class="form-horizontal">
    <fieldset>

    <!-- Form Name -->
    <legend></legend>

    <!-- Multiple Checkboxes -->
    <div class="form-group">
      <label class="col-md-4 control-label" for="type">Típus</label>
      <div class="col-md-4">
      <div class="checkbox">
        <label for="type-0">
        <input type="checkbox" name="type[]" id="type-0" value="stake" <?php echo in_array('stake', $type)?'checked':''; ?>/>
          Stakeholderek
        </label>
        </div>
      <div class="checkbox">
        <label for="type-1">
          <input type="checkbox" name="type[]" id="type-1" value="zone" <?php echo in_array('zone', $type)?'checked':''; ?>/>
          Vállalkozási övezetek
        </label>
        </div>
      <div class="checkbox">
        <label for="type-2">
          <input type="checkbox" name="type[]" id="type-2" value="estate" <?php echo in_array('estate', $type)?'checked':''; ?>/>
          Ingatlanok
        </label>
        </div>
      <div class="checkbox">
        <label for="type-3">
          <input type="checkbox" name="type[]" id="type-3" value="nature" <?php echo in_array('nature', $type)?'checked':''; ?>/>
          Természeti értékek
        </label>
        </div>
      </div>
    </div>

    <!-- Multiple Checkboxes -->
    <div class="form-group">
      <label class="col-md-4 control-label" for="country">Ország</label>
      <div class="col-md-4">
      <div class="checkbox">
        <label for="country-0">
          <input type="checkbox" name="country[]" id="country-0" value="hu" <?php echo in_array('hu', $country)?'checked':''; ?>/>
          Magyarország
        </label>
        </div>
      <div class="checkbox">
        <label for="country-1">
          <input type="checkbox" name="country[]" id="country-1" value="cr" <?php echo in_array('cr', $country)?'checked':''; ?>/>
          Horvátország
        </label>
        </div>
      </div>
    </div>

    <!-- Button (Double) -->
    <div class="form-group">
      <label class="col-md-4 control-label" for="button1id"></label>
      <div class="col-md-8">
        <button id="button1id" type="submit" name="button1id" class="btn btn-success">Szűrés</button>
        <br />
        <br />
        <button id="button2id" type="reset" name="button2id" class="btn btn-danger">Feltételek törlése</button>
      </div>
    </div>

    </fieldset>
    </form>

    </div>
    <div id="map-canvas"></div>
    <script type="text/javascript">
    $(document).ready( function() {
        $("#filter-panel").draggable({});
        $("#filter-panel").css('position','absolute');
    });
    </script>
  </body>
</html>
